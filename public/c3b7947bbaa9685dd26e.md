---
title: 'Railsã§Sassè‡ªå‹•ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«, assetsã®è¨­å®š - RailsTIL(4h)'
tags:
  - Ruby
  - Rails
  - '#TIL'
private: false
updated_at: '2024-09-28T19:37:52+09:00'
id: c3b7947bbaa9685dd26e
organization_url_name: null
slide: false
ignorePublish: false
---
## tailwindã¨Sass(dartsass)ã‚’ä½¿ã†
- tailwindcssã‚’railsã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€dartsassã®è‡ªå‹•ãƒ“ãƒ«ãƒ‰ãŒåŠ¹ã‹ãªããªã‚‹ãŸã‚
- dartsassã®è‡ªå‹•ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™
```diff_ada:Procfile.dev
web: bin/rails server -b 0.0.0.0 -p 3200
css: bin/rails tailwindcss:watch
+ css: bin/rails dartsass:watch
```

## è¡¨ç¤ºãŒå¤‰ã‚ã‚‰ãªã„ãƒ»ãŠã‹ã—ã„ã¨ã
- public/assetsã®å†…å®¹ã‚’å…¨ã¦å‰Šé™¤
- rails assets:precompileå®Ÿè¡Œæ™‚ã«ç”Ÿæˆã•ã‚Œã€è¡¨ç¤ºã«å„ªå…ˆã•ã‚Œã¾ã™ã€‚é–‹ç™ºæ™‚ã¯è¦ã‚Šã¾ã›ã‚“ã€‚

## ãã‚Œã§ã‚‚ãŠã‹ã—ã„ã¨ã
- application.scssã®å†…å®¹ã‚’ãƒ¡ãƒ¢å¸³ã«ã‚³ãƒ”ãƒ¼ã€ãã—ã¦ä»¥ä¸‹ï¼’ã¤ã®ãƒ•ã‚©ãƒ«ãƒ€å†…å®¹ã‚’ã™ã¹ã¦å‰Šé™¤
```
app/assets/stylesheets
app/assets/builds
```
- å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
```
rails tailwindcss:install
./bin/rails dartsass:install
```
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ãŸã‚‰ãƒ¡ãƒ¢å¸³ã«ã‚³ãƒ”ãƒ¼ã—ãŸapplication.scssã®å†…å®¹ã‚’æˆ»ã—ã¾ã™ã€‚

## gemã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã

```
bundle exec gem uninstall tailwindcss-rails
bundle install
```


## application.html.erb
```erb:application.html.erb
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JDIAPP</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "tailwind", "inter-font", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  <body>
    <main>
      <%= yield %>
    </main>
  </body>
</html>
```
 

### è£œè¶³èª¬æ˜

```
<%= csrf_meta_tags %>
```
- ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªã®å¯¾ç­–ãƒˆãƒ¼ã‚¯ãƒ³ã§ã™ã€‚ï¼ˆdeviseã§å¿…é ˆï¼‰

```
<%= javascript_importmap_tags %>
```
- config/importmap.rbã‚’ç¢ºèªã—ã¦jsã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
- app/javascript/application.jsã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## javascript/application.js
```javascript:applicaion.js
import "@hotwired/turbo-rails";
import "controllers";
import "task";
```
- importmapã§å®£è¨€ã—ãŸã‚‚ã®ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

## config/importmap.rb
```ruby:importmap.rb
pin "application", preload: true
pin "@hotwired/turbo-rails", to: "turbo.min.js", preload: true
pin "@hotwired/stimulus", to: "stimulus.min.js", preload: true
pin "@hotwired/stimulus-loading", to: "stimulus-loading.js", preload: true
pin_all_from "app/javascript/controllers", under: "controllers"
pin "task", to: "task.js"
pin "sortablejs", to: "https://ga.jspm.io/npm:sortablejs@1.15.0/modular/sortable.esm.js"
```
- pin_all_fromã§controllerãƒ•ã‚©ãƒ«ãƒ€ã‚’ã¾ã¨ã‚ã¦æŒ‡å®šã§ãã¾ã™ã€‚

## manifest.js
```javascript:manifest.js
//= link_tree ../images
//= link_tree ../../../vendor/javascript .js
//= link_tree ../builds
//= link task.js
//= link controllers/application.js
//= link controllers/clipboard_controller.js
//= link controllers/hello_controller.js
//= link controllers/index.js
//= link controllers/sortable_controller.js
```

- ã‚³ãƒ¡ãƒ³ãƒˆä»˜ã„ã¦ã„ã¦æ­£è§£ã§ã™ã€‚ä½¿ã‚ãªã„ã¨ãã¯=ã‚’å¤–ã™ã‹ã€=ã®å‰ã«ç©ºç™½ã‚’å…¥ã‚Œã¾ã™ã€‚
- css, javascriptãªã©ã®assetsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

## ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
https://stimulus.hotwired.dev/handbook/building-something-real
- æ—¥æœ¬èªè¨³ã§èª­ã‚€ã¨ç°¡å˜ã«å®Ÿè£…ã§ããã†ã§ã™ã€‚


## æ—¥ä»˜ã®è¡¨ã—æ–¹

```javascript
const today = new Date()
    .toLocaleDateString("ja-JP", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
    })
    .replaceAll("/", "-");

// å‡ºåŠ›ã¯2024-09-27
```

## ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹
```javascript:clipboard_controller.js
copy() {
    const getToday = () => {
      const today = new Date()
        .toLocaleDateString("ja-JP", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
        })
        .replaceAll("/", "-");

        //ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        navigator.clipboard.writeText(targetValue).then(today);
    };

    getToday();
}
```

```erb:_main.html.erb
<%= button_tag 'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼',data: { controller: "clipboard,", action: "click->clipboard#copy" } %>
```

## JSã®å­¦ç¿’
### é…åˆ—ã«æ”¹è¡Œã‚’åŠ ãˆã‚‹
```javascript
const taskHTML = data.tasks.join("\n");
// tasks:[1,2,3]
//  ğŸ‘‡ï¸ æ”¹è¡Œã•ã‚Œã¾ã™
//   1
//   2
//   3
```
- æ”¹è¡Œã‚’console.log(taskHTML)ã§ç¢ºèªã§ãã¾ã™ã€‚

### Railsã¸ã®get, put

```javascript:fetch
fetch("/tasks/response_data", {
  method: "GET",
  headers: {
    "Content-Type": "application/json",
  },
})
  .then((response) => response.json())
  .then((data) => {
    makeResData(data);
  })
  .catch((error) => {
    console.error("Error:", error);
  });
```
```javascript:put
import { put } from "@rails/request.js"

put(`/tasks/${evt.item.dataset.sortableId}/sort`, {
  body: JSON.stringify({row_order_position: evt.newIndex})
})
```

## Railsã®å­¦ç¿’
```ruby:tasks_controller.rb
  def response_data
    tasks = Task.includes(:user).where(user_id: current_user.id).rank(:row_order)
    archives = Archive.includes(:user).where(user_id: current_user.id).order(created_at: :desc)
    arrayTask = []
    arrayArchive = []
    tasks.each do |task|
      arrayTask.push(task.content)
    end
    archives.each do |archive|
      arrayArchive.push(archive.content)
    end
    data = { tasks: arrayTask, archives: arrayArchive }
    render json: data
  end
```

```ruby:routes.rb
  resources :tasks, only: [:index, :create, :edit, :update, :destroy] do
    collection do
      delete 'destroy_task_item', to: 'tasks#destroy_task_item'
      delete 'destroy_archive_item', to: 'tasks#destroy_archive_item'
      get 'response_data', to: 'tasks#response_data'
    end
    member do
      put :sort
      patch 'mark_as_done', to: 'tasks#mark_as_done'
    end
  end
```
- member do ã¯tasks/:id/sortã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
- ä»Šå›ã®response_dataã¯collection do ã«è¿½è¨˜ã—ã¾ã—ãŸã€‚

## Rails Routes

- routesã¯terminalã‚ˆã‚Šã€webã®ã»ã†ãŒè¦‹ã‚„ã™ã„ã§ã™ã€‚
http://localhost:3000/rails/info/routes

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3822203/3953709e-11f7-5b9d-a7a8-44763224e74e.png)


ä»¥ä¸Šã§ã™ã€‚

ruu2023
